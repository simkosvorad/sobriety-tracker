<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sobriety Achievement Tracker</title>
  <style>
    /* same CSS as before, unchanged */
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>🎮 Sobriety Achievement Tracker</h1>
      <div class="toolbar">
        <button id="exportBtn">Export</button>
        <label class="btn" for="importFile">Import<input id="importFile" type="file" accept="application/json" hidden></label>
        <button id="printBtn">Print</button>
        <button id="resetBtn" class="danger">Reset</button>
      </div>
    </header>

    <section class="summary card">
      <div class="counts" id="counts">Loading…</div>
      <div class="progress"><div id="overallBar"></div></div>
      <div class="small">Click an achievement to unlock it. Notes fields are editable—use them for reflections, triggers, or rewards.</div>
    </section>

    <section class="grid" id="tiers"></section>

    <details style="margin-top:16px">
      <summary>➕ Add a custom achievement</summary>
      <div class="row">
        <select id="newTier">
          <option value="bronze">Bronze</option>
          <option value="silver">Silver</option>
          <option value="gold">Gold</option>
          <option value="platinum">Platinum</option>
          <option value="bonus">Bonus/Hidden</option>
        </select>
        <input type="text" id="newTitle" placeholder="Achievement title" size="36"/>
        <input type="text" id="newDesc" placeholder="Description (optional)" size="36"/>
        <button id="addBtn" class="primary">Add</button>
      </div>
    </details>

    <footer>
      Built for personal motivation. Data is stored in your browser. 💚
    </footer>
  </div>

  <script>
  const KEY = 'sobriety-achievements-v2';

  const DEFAULTS = [
    // Bronze
    ['First Step Taken','bronze','Attend your first recovery meeting or admit your goal.'],
    ['Dry Day','bronze','Complete one full day without alcohol.'],
    ['Weekend Warrior','bronze','Make it through your first full weekend sober.'],
    ['Call for Backup','bronze','Reach out to a friend, sponsor, or support system instead of drinking.'],
    ['Knowledge is Power','bronze','Read an article or book chapter about recovery.'],
    // Silver
    ['One Week Strong','silver','Reach 7 consecutive days sober.'],
    ['Mind Over Matter','silver','Resist a craving trigger successfully.'],
    ['Healthy Swap','silver','Replace a drinking ritual with a healthier habit.'],
    ['Builder','silver','Stick to a daily routine for 2 weeks.'],
    ['Social Shield','silver','Attend a social event without drinking.'],
    ['Level Up Sleep','silver','Get restful sleep for a week.'],
    // Gold
    ['30 Days Clear','gold','Stay sober for one full month.'],
    ['Stress Tested','gold','Handle a stressful situation sober.'],
    ['Chain Reaction','gold','Complete 21 days in a row of a healthy practice.'],
    ['Relationship Healer','gold','Repair or strengthen a relationship affected by drinking.'],
    ['Financial Freedom','gold','Save or reallocate money previously spent on alcohol.'],
    ['Public Declaration','gold','Share your milestone with someone else.'],
    // Platinum
    ['90 Days Strong','platinum','Reach 3 months sober.'],
    ['Half-Year Hero','platinum','Reach 6 months sober.'],
    ['One Year Clear','platinum','Reach 1 year sober.'],
    ['Mentor Mode','platinum','Encourage someone else starting their journey.'],
    ['Identity Shift','platinum','See yourself genuinely as a non-drinker.'],
    ['Legacy Unlocked','platinum','Build a project or goal that symbolizes sober life.'],
    // Bonus
    ['Crisis Controller','bonus','Overcome a major crisis without relapsing.'],
    ['Epic Comeback','bonus','Recover quickly after a relapse.'],
    ['Double XP Weekend','bonus','Replace a weekend binge with healthy activities.'],
    ['Boss Battle Won','bonus','Face your biggest trigger and win.'],
    ['Collector','bonus','Complete a streak of all daily goals for 30 days.'],
  ].map(([title,tier,desc],i)=>({
    id:`def-${i+1}`, title, tier, desc,
    unlocked:false, unlockedAt:null, notes:''
  }));

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return DEFAULTS;
      return JSON.parse(raw);
    }catch{ return DEFAULTS }
  }
  function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }

  let state = load();

  const tiersEl=document.getElementById('tiers');
  const countsEl=document.getElementById('counts');
  const overallBar=document.getElementById('overallBar');

  const TIER_ORDER=['bronze','silver','gold','platinum','bonus'];
  const TIER_LABEL={bronze:'🥉 Bronze',silver:'🥈 Silver',gold:'🥇 Gold',platinum:'🏆 Platinum',bonus:'✨ Bonus'};

  function render(){
    const map={bronze:[],silver:[],gold:[],platinum:[],bonus:[]};
    state.forEach(a=>map[a.tier]?.push(a));
    tiersEl.innerHTML='';
    TIER_ORDER.forEach(tier=>{
      if(!map[tier].length) return;
      const card=document.createElement('section');
      card.className=`card tier-${tier}`;
      card.innerHTML=`<h2>${TIER_LABEL[tier]}</h2>`;
      map[tier].forEach(a=>{
        const row=document.createElement('div');
        row.className='ach';
        row.innerHTML=`
          <input type="checkbox" ${a.unlocked?'checked':''} data-id="${a.id}">
          <div>
            <div class="title">${escapeHtml(a.title)}</div>
            <div class="meta" id="meta-${a.id}">${a.unlocked?`Unlocked: ${fmtDate(a.unlockedAt)}`:'Locked'}</div>
            <div class="desc">${escapeHtml(a.desc||'')}</div>
            <div class="notes" contenteditable="true" data-notes-id="${a.id}">${escapeHtml(a.notes||'')}</div>
          </div>`;
        card.appendChild(row);
      });
      tiersEl.appendChild(card);
    });
    updateSummary();
  }

  function updateSummary(){
    const total=state.length;
    const unlocked=state.filter(a=>a.unlocked).length;
    const pct=total?Math.round((unlocked/total)*100):0;
    countsEl.textContent=`Unlocked ${unlocked}/${total} (${pct}%)`;
    overallBar.style.width=pct+'%';
  }

  function fmtDate(ts){const d=new Date(ts);return d.toLocaleDateString()+" "+d.toLocaleTimeString();}
  function escapeHtml(s){return String(s).replace(/[&<>\"] /g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[c]));}

  tiersEl.addEventListener('change',e=>{
    const cb=e.target.closest('input[type="checkbox"]');
    if(!cb) return;
    const id=cb.getAttribute('data-id');
    const a=state.find(x=>x.id===id);
    if(!a) return;
    a.unlocked=cb.checked;
    a.unlockedAt=cb.checked?Date.now():null;
    save();
    render();
  });

  tiersEl.addEventListener('input',e=>{
    const notes=e.target.closest('[data-notes-id]');
    if(!notes) return;
    const id=notes.getAttribute('data-notes-id');
    const a=state.find(x=>x.id===id);
    a.notes=notes.innerText.trim();
    save();
  });

  document.getElementById('resetBtn').addEventListener('click',()=>{
    if(confirm('Clear all progress?')){state=DEFAULTS.map(d=>({...d}));save();render();}
  });
  document.getElementById('exportBtn').addEventListener('click',()=>{
    const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');a.href=url;a.download='sobriety.json';a.click();URL.revokeObjectURL(url);
  });
  document.getElementById('importFile').addEventListener('change',e=>{
    const f=e.target.files[0];if(!f) return;const r=new FileReader();r.onload=()=>{try{state=JSON.parse(r.result);save();render();}catch{alert('Invalid file')}};r.readAsText(f);
  });
  document.getElementById('printBtn').addEventListener('click',()=>window.print());
  document.getElementById('addBtn').addEventListener('click',()=>{
    const tier=document.getElementById('newTier').value;
    const title=document.getElementById('newTitle').value.trim();
    const desc=document.getElementById('newDesc').value.trim();
    if(!title) return alert('Enter a title');
    state.push({id:'custom-'+Date.now(),title,tier,desc,unlocked:false,unlockedAt:null,notes:''});
    save();render();
    document.getElementById('newTitle').value='';
    document.getElementById('newDesc').value='';
  });

  render();
  </script>
</body>
</html>
